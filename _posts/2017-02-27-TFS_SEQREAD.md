---
layout: post
title: z走近科学，单块读的全表扫描？！
date: 2017-02-27
categories: Oracle
tags: [Oracle]
description: Oracle全表扫描引发单块读等待事件的情况。
---

今天一个朋友和我说了一个很有趣的情况，他的一个客户在执行select语句的时候，很久都没有执行出来，他当时进行查看，发现执行计划为全表扫描，但是等待事件却是大量的“db file sequential read”，然后他的客户告诉他，这个可能是Oracle的一个BUG，让他去查原因。于是他就来找我聊这个事情了。当时让他根据AWR视图查询了一下发生这个情况的时候的对应单块读的对象是什么，结果发现了大量的UNDO读，这就可以解释为什么会有单块读，当时应该是在他查询时刻的时候，有一些dml操作相同的表，导致需要构建CR块才能获得一致性的镜像。

后来回来，头脑风暴了一下，能引起这种全表扫描的单块读等待事件的情况应该很多，下面就罗列一下我能想到的：

1. 在发起查询但是查询未扫描完的情况下，有大量dml操作并提交，当查询会话查询到更改的块的时候，需要读UNDO构建一致性镜像，而UNDO读是单块读。

2. 表中存在大量行迁移，行链接的情况，也会发生单块读等待事件。

3. 表或者索引的大部分块在buffer cache中，然后另一部分不连续的块在磁盘上，读取这部分的时候，也是单块读。

4. LOB字段的读取，LOB列的索引，这部分是单块读。

5. 读取段头的时候，会发生单块读。

6. 多块读参数设置为1，即参数“db_file_multiblock_read_count”。


嗯，目前我想到的大概就这些情况，如果后期发现有别的情况会引起这种“奇怪”的现象，在补充，不过这种有点“反常”的情况出现的时候，先不要把“锅”丢给Oracle，毕竟Oracle这个软件经过这么多年已经很完善了，首先还是根据经验去一步一步的排查下吧，嘿嘿~



![小w](https://wx2.sinaimg.cn/mw1024/891ecf4fly1fr361nvrcnj207w07sad7.jpg)

###### 博文内容为小w原创，部分内容引用自官方资料，如转载请注明出处。^_^

###### 感谢关注w的小站，本小站将不定期(完全看心情～)更新分享技术知识，欢迎阅读，网址：www.itwwb.com



